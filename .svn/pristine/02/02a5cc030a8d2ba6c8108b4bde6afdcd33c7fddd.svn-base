#!/usr/bin/env python
# -*- coding:utf-8 -*-
#

import os, pyodbc

os.putenv("INFORMIXDIR", "/opt/IBM/informix")
import IfxPyDbi

def conecta_informix(banco='minas'):
   try:
      ifx = IfxPyDbi.connect(f"SERVER=servlxcordes;DATABASE={banco};UID=informix;PWD=BDDlnx10;DB_LOCALE=en_us.1252") if os.getenv('AMBIENTE_NSS') != 'PRODUCAO' else \
            IfxPyDbi.connect(f"SERVER=servlxcorpro;DATABASE={banco};UID=informix;PWD=BDDlnx10;DB_LOCALE=en_us.1252")
   except:
      ifx = None
   else:
      ifx.set_autocommit(True)
      cr = ifx.cursor()
      cr.execute("set lock mode to wait 60")
      cr.execute("set isolation to committed read")
      cr.close()

   return ifx

def conecta_mssql():
   try:
      sql = pyodbc.connect('Driver=FreeTDS;Server=servwsqldeserp;port=1433;uid=sa;pwd=@deti@20@;database=MinasCorporativo',autocommit=True) if os.getenv('AMBIENTE_NSS') != 'PRODUCAO' else \
            pyodbc.connect('Driver=FreeTDS;Server=servwbdsqlsgc;port=1433;uid=sa;pwd=@mil960@;database=MinasCorporativo',autocommit=True)
   except:
      sql = None

   return sql

# Teste
#
if __name__ == "__main__":

   ifx = conecta_informix()
   if ifx:
      print('Conexão informix ok')
   else:
      print('Banco informix não disponível')

   sql = conecta_mssql()
   if sql:
      print('Conexão mssql ok')
   else:
      print('Banco mssql não disponível')
